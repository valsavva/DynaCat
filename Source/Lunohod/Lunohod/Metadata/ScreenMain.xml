<?xml version="1.0" encoding="UTF-8"?>

<Screen Bounds="0,0,480,320" IsModal="true">
    <Include File="CommonScreenFunctionality.xml" />
    <Include File="ClassUIMovingBackground.xml" />
	<Include File="CommonTextures.xml" />
    <Include File="ClassSFX.xml" />
    <Include File="ClassUIButton.xml" />
    <Include File="ClassUIMuteButton.xml" />

    <Resources RootFolder="Global">
        <Texture Id="txrBackground" Source="scr_main_bg" />
        <Texture Id="txrLight" Source="scr_light_white" />
        <Texture Id="txrSeriesPanel1" Source="scr_main_panel01" />
        <Texture Id="txrSeriesPanel2" Source="scr_main_panel02" />
        <Texture Id="txrSeriesPanel3" Source="scr_main_panel03" />
        <Texture Id="txrLogo" Source="scr_main_logo" />
        <!--<Texture Id="txrLabels" Source="scr_levels_names" />-->
    </Resources>

	<Class Id="clsSeriesPanel">
        <Group RotationCenter="72,74">
            <!--<Do Action="this_Label.CurrentFrame=@seriesNumberParam-1" InProgress="true" RepeatCount="1" />-->
			<Image TextureId="txrSeriesPanel@seriesNumberParam" StretchMode="ActualSize" />
            <!--<Sprite Id="this_Label" TextureId="txrLabels" Bounds="34,4,91,41" FrameBounds="0,0,129,58" />-->
            <TapArea Action="this_setAnimatePress.Start()" />
            <SequenceSet Id="this_setAnimatePress">
                <Do Action="imgHeroAnm.Opacity=0;imgRat1Anm.Opacity=0" />
                <NumAnimation Target="this.Scale" From="1" To="1.05" Duration="0.2" Autoreverse="true" RepeatCount="1"/>
                <Do Action="system.StartSeries(@seriesNumberParam);" />
            </SequenceSet>
			<Text Text="=system.Str(system.GetSeriesScore(@seriesNumberParam))" Location="65,125" FontId="Splash14Font" Scale="0.7" />
			<Text Text="=system.Str(system.GetSeriesStars(@seriesNumberParam))+'/'+system.Str(system.GetSeriesAvailableStars(@seriesNumberParam))" Location="27,95" FontId="Splash14Font" Scale="0.7" />
			<Text Text="=system.Str(system.GetSeriesBadges(@seriesNumberParam))+'/'+system.Str(system.GetSeriesLevelCount(@seriesNumberParam))" Location="95,95" FontId="Splash14Font" Scale="0.7" />
        </Group>
	</Class>

	<Layer Id="background">
       <Music Id="sndGameMusic" FileId="sfGameMusic" Enabled="true" IsLooped="true" Volume="0.8"/>
       <BoolTrigger Condition="(system:screenActivated) and (sndGameMusic.Volume==0)" EnterAction="anmMusicVolumeUp.Start()" />
       <NumAnimation Id="anmMusicVolumeUp" Target="sndGameMusic.Volume" From="0" To="0.8" Duration="0.5" RepeatCount="1"/>
       
        <Group Class="clsMovingBackground" ClassParams="@textureIdParam=txrBackground" />
	</Layer>

	<Layer>
        
<!-- animations -->        
        <!-- 1: hero comes, looks around and returns -->
        <Class Id="clsMSAnimation1">
            <SequenceSet RepeatCount="1">
                <Do Action="imgHeroAnm.X=@heroStartX;
                    imgHeroAnm.Y=@heroStartY" />
                <NumAnimation Target="imgHeroAnm.Opacity" From="0" To="1" Duration="2" RepeatCount="1" Fill="End"/>
                <Delay Duration="0.8" />
                <Do Action="imgHeroAnm.CurrentFrame=1" />
                <Delay Duration="0.8" />
                <Do Action="imgHeroAnm.CurrentFrame=2" />
                <Delay Duration="0.8" />
                <RandomSet RepeatCount="1" >
                    <Do Action="imgHeroAnm.CurrentFrame=14" />
                    <Do Action="imgHeroAnm.CurrentFrame=13" />
                    <Do Action="imgHeroAnm.CurrentFrame=18" />
                    <Do Action="imgHeroAnm.CurrentFrame=22" />
                </RandomSet>
                <Delay Duration="1.5" />
                <NumAnimation Target="imgHeroAnm.Opacity" From="imgHeroAnm.Opacity" To="0" Duration="3" RepeatCount="1" Fill="End"/>
                <Do Action="imgHeroAnm.CurrentFrame=0" />
            </SequenceSet>
        </Class>
        
        <!-- rat1 -->
        <Class Id="clsMSAnimationRat1">
            <SequenceSet RepeatCount="1">
                <Do Action="imgRat1Anm.X=@Rat1StartX;
                    imgRat1Anm.Y=@Rat1StartY" />
                <Do Action="imgRat1Anm.CurrentFrame=1" />
                <NumAnimation Target="imgRat1Anm.Opacity" From="0" To="1" Duration="2" RepeatCount="1" Fill="End"/>
                <Delay Duration="0.4" />
                <Do Action="imgRat1Anm.CurrentFrame=3" />
                <Delay Duration="0.8" />
                <Do Action="imgRat1Anm.CurrentFrame=6" />
                <Delay Duration="0.8" />
                <Do Action="imgRat1Anm.CurrentFrame=1" />
                <Delay Duration="0.125" />
                <RandomSet RepeatCount="1">
                    <NumAnimation Target="imgRat1Anm.CurrentFrame" From="9" To="29" Duration="2.625" RepeatCount="1" Fill="End"/>
                    <SequenceSet RepeatCount="1">
                        <NumAnimation From="30" To="38" Duration="1.125" Target="imgRat1Anm.CurrentFrame"  RepeatCount="1" Fill="End"/>
                        <NumAnimation From="39" To="40" Duration="0.25" Target="imgRat1Anm.CurrentFrame" RepeatCount="3" Fill="End"/>
                        <NumAnimation From="41" To="43" Duration="0.375" Target="imgRat1Anm.CurrentFrame" RepeatCount="1" Fill="End"/>
                    </SequenceSet>
                </RandomSet>
                <Do Action="imgRat1Anm.CurrentFrame=1" />
                <Delay Duration="1.5" />
                <NumAnimation Target="imgRat1Anm.Opacity" From="imgRat1Anm.Opacity" To="0" Duration="3" RepeatCount="1" Fill="End"/>
            </SequenceSet>
        </Class>
        
        <!-- main loop -->
        <SequenceSet RepeatCount="0" InProgress="true">
            <Do Action="@anmPause=system.Rnd(7,10)" />
            <Delay Duration="@anmPause" />
            <RandomSet RepeatCount="1">
                <SequenceSet Class="clsMSAnimation1" ClassParams="@heroStartX=89,@heroStartY=85"/>
                <SequenceSet Class="clsMSAnimation1" ClassParams="@heroStartX=245,@heroStartY=85"/>
                <SequenceSet Class="clsMSAnimation1" ClassParams="@heroStartX=405,@heroStartY=85"/>

                <SequenceSet Class="clsMSAnimationRat1" ClassParams="@Rat1StartX=81,@Rat1StartY=90"/>
                <SequenceSet Class="clsMSAnimationRat1" ClassParams="@Rat1StartX=238,@Rat1StartY=90"/>
                <SequenceSet Class="clsMSAnimationRat1" ClassParams="@Rat1StartX=394,@Rat1StartY=90"/>
            </RandomSet>
        </SequenceSet>
                
<!-- bttns -->

        <Image Id="imgLight1" TextureId="txrLight" Bounds="32, -170, 600, 554" RotationCenter="208,200" Opacity="0.4" BackColor="#abb7f3"/>
        <NumAnimation Target="imgLight1.Rotation" From="0" To="-360" Duration="100" Autoreverse="false" RepeatCount="0"  InProgress="true"/>
        <Image Id="imgLight2" TextureId="txrLight" Bounds="32, -170, 600, 554" RotationCenter="208,200" Opacity="0.4" BackColor="#abb7f3"/>
        <NumAnimation Target="imgLight2.Rotation" From="0" To="360" Duration="91" Autoreverse="false" RepeatCount="0"  InProgress="true"/>

        <Image TextureId="txrLogo" Location="140,-20"/>

        <Group Id="grpSeries1Panel" Bounds="010,080,149,152" Class="clsSeriesPanel" ClassParams="@seriesNumberParam=1" />
        <Group Id="grpSeries1Pane2" Bounds="165,080,149,152" Class="clsSeriesPanel" ClassParams="@seriesNumberParam=2" />
        <Group Id="grpSeries1Pane3" Bounds="320,080,149,152" Class="clsSeriesPanel" ClassParams="@seriesNumberParam=3" />

        <Sprite Id="imgHeroAnm" TextureId="txrHero" Bounds="0, 0, 47, 59" FrameBounds="0,0,47,59" FrameCount="5" CurrentFrame="0" Opacity="0"/>
        <Sprite Id="imgRat1Anm" TextureId="txrEnemyRat2Sheet" Bounds="0, 0, 60, 52" FrameBounds="0,0,60,52" FrameCount="4" CurrentFrame="1" Opacity="0"/>

        
       
        
        <Group Id="btnCredits" Class="clsButton" ClassParams="@BtnImg=info" Bounds="20, 245,62,62">
		    <BoolTrigger Condition="btnCredits:Action" EnterAction="system.StartScreen('ScreenCredits.xml')" />
		</Group>
		<Group Id="btnMute" Bounds="85,245,62,62" Class="clsMuteButton" />
    
</Layer>
</Screen>