<?xml version="1.0" encoding="utf-8" ?>
<!--<Level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="file:///D:/Lunohod/Documentation/schema0.xsd" Name="AlphaTest5ME" Bounds="0, 0, 480, 320">-->
<Include>
    <Resources RootFolder="Textures">
        <Texture Id="txrRadarSprite_1" Source="radar_spr_01" />
        <Texture Id="txrRadarSprite_2" Source="radar_spr_02" />
        <Texture Id="txrWaves" Source="radar_wave_spr_87x33x4.png" />
    </Resources>

    <Class Id="clsMagneticRadar">
        <Group>
            <Do Action="@this_dirX=@paramDirX;@this_dirY=@paramDirY;" InProgress="true" />

            <!-- init horizontal, shooting right -->
            <BoolTrigger Id="this_init1" Condition="@this_dirX==1">
                <Do Action="this_grpMagnetWaves.SetBounds(this_blkExcavator.X+60, 7, 500, 26)" RepeatCount="1" InProgress="true"/>
                <Do Action="this_sprRadar.FlipEffects='Horizontally'" RepeatCount="1" InProgress="true" />
                <Do Action="this_init1.Disable();
                    this_init2.Disable();
                    this_init3.Disable();
                    this_init4.Disable()" />
            </BoolTrigger>
            
            <!-- init horizontal, shooting left -->
            <BoolTrigger Id="this_init2" Condition="@this_dirX==-1">
                <Do Action="this_grpMagnetWaves.SetBounds(this_blkExcavator.X-512, 9, 512, 26)" RepeatCount="1" InProgress="true"/>
                <Do Action="this_init1.Disable();
                    this_init2.Disable();
                    this_init3.Disable();
                    this_init4.Disable()" />
            </BoolTrigger>
            
            <!-- init vertical, shooting down -->
            <BoolTrigger Id="this_init3" Condition="@this_dirY==1">
                <Do Action="this_grpMagnetWaves.SetBounds(7, this_blkExcavator.Y+60, 26, 300)" RepeatCount="1" InProgress="true"/>
                <Do Action="this_init1.Disable();
                    this_init2.Disable();
                    this_init3.Disable();
                    this_init4.Disable()" />
            </BoolTrigger>
            
            <!-- init vertical, shooting up -->
            <BoolTrigger Id="this_init4" Condition="@this_dirY==-1">
                <Do Action="this_grpMagnetWaves.SetBounds(7, this_blkExcavator.Y-300, 26, 300)" RepeatCount="1" InProgress="true"/>
                <Do Action="this_init1.Disable();
                    this_init2.Disable();
                    this_init3.Disable();
                    this_init4.Disable()" />
            </BoolTrigger>
			
            <!-- excavator -->
            
            <Block Id="this_blkExcavator" Edges="Stick">

                <Sprite Id="this_sprRadar" TextureId="txrRadarSprite_1" Bounds="0,0,52,51" FrameBounds="0,0,52,51"/>
                <NumAnimation Id="this_RadarAnm" From="0" To="3" Duration="1" Autoreverse="false" Target="this_sprRadar.CurrentFrame" RepeatCount="0" Fill="Reset"/>

                <!--<Image TextureId="blank" BackColor="#0000FF" Opacity="0.5"/>-->
            </Block>
            
            <!-- waves -->
    
            <Group Id="this_grpMagnetWaves">
                <SequenceSet RepeatCount="0" InProgress="true" >
                    <Do Action="this_RadarAnm.Start()" />
                    <Delay Duration="0.5" />
                    <Do Action="this:+IsBeaming" />
                    <Do Action="this_ShowWaves.Start()" /><!--this_grpMagnetWaves.Opacity=1-->
                    <Delay Duration="3.5" />
                    <Do Action="this_HideWaves.Start()" />
                    <Delay Duration="0.5" />
                    <Do Action="this_RadarAnm.Stop();
                        this:-IsBeaming;
                        hero:-Magneted;
                        hero:-Magneting;
                        this_anmSetHeroOnHor.Pause();
                        this_anmSetHeroOnVert.Pause()" />
                    <Delay Duration="3.5" />
                </SequenceSet>

                <SequenceSet Id="this_ShowWaves" RepeatCount="1" InProgress="false" >
                    <Do Action="this_Wave1.Opacity=1" />
                    <Delay Duration="0.05" />
                    <Do Action="this_Wave2.Opacity=1" />
                    <Delay Duration="0.05" />
                    <Do Action="this_Wave3.Opacity=1" />
                    <Delay Duration="0.05" />
                    <Do Action="this_Wave4.Opacity=1" />
                    <Delay Duration="0.05" />
                    <Do Action="this_Wave5.Opacity=1" />
                    <Delay Duration="0.05" />
                    <Do Action="this_Wave6.Opacity=1" />
                    <Delay Duration="0.05" />
                </SequenceSet>

                <SequenceSet Id="this_HideWaves" RepeatCount="1" InProgress="false" >
                    <Do Action="this_Wave6.Opacity=0" />
                    <Delay Duration="0.05" />
                    <Do Action="this_Wave5.Opacity=0" />
                    <Delay Duration="0.05" />
                    <Do Action="this_Wave4.Opacity=0" />
                    <Delay Duration="0.05" />
                    <Do Action="this_Wave3.Opacity=0" />
                    <Delay Duration="0.05" />
                    <Do Action="this_Wave2.Opacity=0" />
                    <Delay Duration="0.05" />
                    <Do Action="this_Wave1.Opacity=0" />
                    <Delay Duration="0.05" />
                </SequenceSet>
                
                <BoolTrigger Condition="@this_dirX==1" Group="this_sttWavesView">
                    <Sprite Id="this_Wave1" TextureId="txrWaves" Bounds="0,-3,87,33" FrameBounds="0,0,87,33" FlipEffects="Horizontally">
                        <NumAnimation From="0" To="3" Duration="0.3" Autoreverse="false" Target="CurrentFrame" RepeatCount="0" InProgress="true"/>
                    </Sprite>
                    <Sprite Id="this_Wave2" TextureId="txrWaves" Bounds="87,-3,87,33" FrameBounds="0,0,87,33" FlipEffects="Horizontally">
                        <NumAnimation From="0" To="3" Duration="0.3" Autoreverse="false" Target="CurrentFrame" RepeatCount="0" InProgress="true"/>
                    </Sprite>
                    <Sprite Id="this_Wave3" TextureId="txrWaves" Bounds="174,-3,87,33" FrameBounds="0,0,87,33" FlipEffects="Horizontally">
                        <NumAnimation From="0" To="3" Duration="0.3" Autoreverse="false" Target="CurrentFrame" RepeatCount="0" InProgress="true"/>
                    </Sprite>
                    <Sprite Id="this_Wave4" TextureId="txrWaves" Bounds="261,-3,87,33" FrameBounds="0,0,87,33" FlipEffects="Horizontally">
                        <NumAnimation From="0" To="3" Duration="0.3" Autoreverse="false" Target="CurrentFrame" RepeatCount="0" InProgress="true"/>
                    </Sprite>
                    <Sprite Id="this_Wave5" TextureId="txrWaves" Bounds="348,-3,87,33" FrameBounds="0,0,87,33" FlipEffects="Horizontally">
                        <NumAnimation From="0" To="3" Duration="0.3" Autoreverse="false" Target="CurrentFrame" RepeatCount="0" InProgress="true"/>
                    </Sprite>
                    <Sprite Id="this_Wave6" TextureId="txrWaves" Bounds="435,-3,87,33" FrameBounds="0,0,87,33" FlipEffects="Horizontally">
                        <NumAnimation From="0" To="3" Duration="0.3" Autoreverse="false" Target="CurrentFrame" RepeatCount="0" InProgress="true"/>
                    </Sprite>
                </BoolTrigger>
                
                <BoolTrigger Condition="@this_dirX==-1" Group="this_sttWavesView">
                    <Sprite Id="this_Wave1" TextureId="txrWaves" Bounds="435,-3,87,33" FrameBounds="0,0,87,33">
                        <NumAnimation From="0" To="3" Duration="0.3" Autoreverse="false" Target="CurrentFrame" RepeatCount="0" InProgress="true"/>
                    </Sprite>
                    <Sprite Id="this_Wave2" TextureId="txrWaves" Bounds="348,-3,87,33" FrameBounds="0,0,87,33">
                        <NumAnimation From="0" To="3" Duration="0.3" Autoreverse="false" Target="CurrentFrame" RepeatCount="0" InProgress="true"/>
                    </Sprite>
                    <Sprite Id="this_Wave3" TextureId="txrWaves" Bounds="261,-3,87,33" FrameBounds="0,0,87,33">
                        <NumAnimation From="0" To="3" Duration="0.3" Autoreverse="false" Target="CurrentFrame" RepeatCount="0" InProgress="true"/>
                    </Sprite>
                    <Sprite Id="this_Wave4" TextureId="txrWaves" Bounds="174,-3,87,33" FrameBounds="0,0,87,33">
                        <NumAnimation From="0" To="3" Duration="0.3" Autoreverse="false" Target="CurrentFrame" RepeatCount="0" InProgress="true"/>
                    </Sprite>
                    <Sprite Id="this_Wave5" TextureId="txrWaves" Bounds="87,-3,87,33" FrameBounds="0,0,87,33">
                        <NumAnimation From="0" To="3" Duration="0.3" Autoreverse="false" Target="CurrentFrame" RepeatCount="0" InProgress="true"/>
                    </Sprite>
                    <Sprite Id="this_Wave6" TextureId="txrWaves" Bounds="0,-3,87,33" FrameBounds="0,0,87,33">
                        <NumAnimation From="0" To="3" Duration="0.3" Autoreverse="false" Target="CurrentFrame" RepeatCount="0" InProgress="true"/>
                    </Sprite>
                    <!--<Image TextureId="blank" BackColor="#00FF00" Opacity="0.5"/>-->
                </BoolTrigger>
                
            </Group>
            
            <IntersectionTrigger ObjectId1="this_grpMagnetWaves" ObjectId2="hero">
                <BoolTrigger Condition="this:IsBeaming 
                             and (@this_dirX==1 or @this_dirX==-1) 
                             and not hero:Magneted 
                             and not hero.IsDead 
                             and not hero:sttExit" 
                             EnterAction="hero:+Magneted;this_anmSetHeroOnHor.Start();
                             @heroTunnelngX=@this_dirX;@heroTunnelngY=0"/>
            </IntersectionTrigger>
            
            <IntersectionTrigger ObjectId1="this_grpMagnetWaves" ObjectId2="hero">
                <BoolTrigger Condition="this:IsBeaming 
                             and (@this_dirY==1 or @this_dirY==-1) 
                             and not hero:Magneted 
                             and not hero.IsDead 
                             and not hero:sttExit" 
                             EnterAction="hero:+Magneted;this_anmSetHeroOnVert.Start();
                             @heroTunnelngX=0;@heroTunnelngY=@this_dirY"/>
            </IntersectionTrigger>
            
            <SequenceSet Id="this_anmSetHeroOnHor" RepeatCount="1" >
                <NumAnimation Target="hero.Y" From="hero.Y" To="this.Y+10" Duration="0.4" RepeatCount="1" Fill="End"/>
                <Do Action="hero:+Magneting;hero.SetDirection(-1*@this_dirX,-1*@this_dirY)" />
            </SequenceSet>

            <SequenceSet Id="this_anmSetHeroOnVert" RepeatCount="1" >
                <NumAnimation Target="hero.X" From="hero.X" To="this.X+6" Duration="0.4" RepeatCount="1" Fill="End"/>
                <Do Action="hero:+Magneting;hero.SetDirection(-1*@this_dirX,-1*@this_dirY)" />
            </SequenceSet>
            
        </Group>
    </Class>
</Include>
