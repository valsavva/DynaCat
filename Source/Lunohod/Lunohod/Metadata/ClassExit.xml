<Include>
<!-- CEHv6 -->
	<Class Id="clsExit">
        <Group>

<!-- Parachute animation-->

            <BoolTrigger Id="this_trgParashutes" Condition="tower:LevelWithParachutes" EnterAction="this.Y=this.Y-60;this.Opacity=0">
                <Image Id="this_imgParachute" TextureId="txr_parachute" Bounds="-5, -48, 53, 62"/>
                <SequenceSet InProgress="true">
                    <Delay Duration="system.Rnd(1,2)" />
                    <Do Action="this.Opacity=1;
                           this.RotationCenterX=19;
                           this.RotationCenterY=-30" />
                    <ParallelSet>
                        <Sound FileId="sndParachute_open" Volume="0.2" Pitch="0" Pan="0"/>
                        <NumAnimation Target="this.Y" From="0" To="60" IsDelta="true" Autoreverse="false" RepeatCount="1" Duration="1.6" Fill="End" />
                        <SequenceSet InProgress="true" RepeatCount="2" >
                            <NumAnimation Target="this.Rotation" From="0" To="-2" Autoreverse="true" Duration="0.2" Fill="End" RepeatCount="1" Smoothing="Smooth"/>
                            <NumAnimation Target="this.Rotation" From="0" To="2" Autoreverse="true" Duration="0.2" Fill="End" RepeatCount="1" Smoothing="Smooth"/>
                        </SequenceSet>
                    </ParallelSet>
                    <NumAnimation Target="this_imgParachute.Opacity" From="1" To="0" IsDelta="false" Autoreverse="false" RepeatCount="1" Duration="0.4" Fill="End" />
                    <Do Action="this_imgParachute.Disable();
                        this.RotationCenterX=0;
                        this.RotationCenterY=0;
                        this_trgParashutes.Disable()" />
                </SequenceSet>
            </BoolTrigger>

<!-- Exit animation-->
            <Image Id="this_imgExitStatic" TextureId="txrExitStatic" Location="-23,-56" />
			<Image Id="this_imgExitFlight" TextureId="txrExitFlight" Location="-23,-56" Enabled="false"/>
            <Image Id="this_imgExitReady" TextureId="txrExitReady" Location="-23,-56" Enabled="false"/>
			<Sound Id="this_sndExitFlight" FileId="sfExitEndLevel" Volume="0.5" Pitch="0" Pan="0" InProfress="true"/>
			<Sprite Id="this_sprExitFlightFire" TextureId="txrExitFlightFire" Bounds="10,41,16,34" FrameBounds="0,0,16,34" Enabled="false">
                <NumAnimation From="0" To="3" Duration="0.15" Autoreverse="true" Target="this_sprExitFlightFire.CurrentFrame" InProgress="true"/>
			</Sprite>
            <Sprite Id="this_sprExitTransform" TextureId="txrExitTransform" Bounds="-23,-56,80,111" FrameBounds="0,0,80,111" Enabled="false" />

            <IntersectionTrigger ObjectId1="hero" ObjectId2="this" EnterAction="this_setExit.Start();hero:+sttExit;this:+StartFlight"/>

            <SequenceSet Id="this_setExit" InProgress="false">
                <Do Action="@heroDepartPointX=hero.X;
                            @heroDepartPointY=hero.Y;                             
                            @heroDestPointX=exit.X;                             
                            @heroDestPointY=exit.Y+10;
                            this_sndExitFlight.Start()"/>
                <Delay Duration="0.2"/>
                <Do Action="this_sprExitTransform.Enable();this_imgExitStatic.Disable()"/>
                <NumAnimation From="0" To="10" Duration="1.375" Autoreverse="false" Target="this_sprExitTransform.CurrentFrame" InProgress="true" RepeatCount="1"/>
                <Delay Duration="0.425"/>
                <Do Action="this_sprExitTransform.Disable();this_imgExitReady.Enable()"/>
				<ParallelSet>
                    <Do Action="this.Depth=0.1;this_sprExitFlightFire.Enable()"/>
                    <SequenceSet RepeatCount="1">
                        <Delay Duration="1" />
                        <Do Action="this_imgExitReady.Disable();this_imgExitFlight.Enable()" />
                    </SequenceSet>
    				<NumAnimation Target="this.X,this.Y,this.Rotation" Duration="2.5" Autoreverse="false" IsDelta="true" RepeatCount="1" Fill="End">
    					<KeyFrame Time="0" Value="0,0,0" Smoothing="Smooth"/>
    					<KeyFrame Time="1" Value="0,-30,0" Smoothing="Smooth"/>
    					<KeyFrame Time="1.5" Value="0,-100,0" Smoothing="Smooth"/>
    					<KeyFrame Time="2.5" Value="-100,-400,-25" Smoothing="Smooth"/>
    				</NumAnimation>
				</ParallelSet>
				<Do Action="system.StartScreen('ScreenLevelComplete.xml')"/>
			</SequenceSet>
						
			<BoolTrigger Condition="this:StartFlight">
				<NumTrigger Property="this.Y" Compare="L" Value="-110" EnterAction="
					this_setExit.Stop();
					system.StartScreen('ScreenLevelComplete.xml')
				" />
			</BoolTrigger>
			
		</Group>
	</Class>

</Include>















