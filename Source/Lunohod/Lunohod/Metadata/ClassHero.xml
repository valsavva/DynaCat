<Include xsi:noNamespaceSchemaLocation="file:///D:/Lunohod/Docs/schema0.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

	<Resources RootFolder="Sound">
		<SoundFile Id="sndHeroDying" Source="skeletonFX_crash_1"/>
		<SoundFile Id="sndHeroEating1" Source="skeletonFX_hero_eating_1"/>
		<SoundFile Id="sndHeroEating2" Source="skeletonFX_hero_eating_2"/>
		<SoundFile Id="sndHeroEating3" Source="skeletonFX_hero_eating_3"/>
		<SoundFile Id="sndHeroEating4" Source="skeletonFX_hero_eating_4"/>
		<SoundFile Id="sndHeroBounce1" Source="skeletonFX_hero_metal_wall_1"/>
		<SoundFile Id="sndHeroBounce2" Source="skeletonFX_hero_metal_wall_2"/>
	</Resources>
	
    <Resources RootFolder="Textures">
        <Texture Id="txrHeroDefault" Source="cat_var_2b"/>
        <Texture Id="txrHeroEating" Source="cat_var_eat_sprite_2x40x41"/>
        <!--<Texture Id="txrHeroEating2" Source="cat_var_eat2"/>-->
        <Texture Id="txrHeroDying" Source="cat_var_2c"/>
        <Texture Id="txrHeroGottaDamage" Source="cat_var_2c"/>
        <Texture Id="txrHeroWaitingExplosion" Source="cat_var_1c"/>
        <Texture Id="txrHeroExplode" Source="cat_var_1a"/>
        <Texture Id="txrHeroExit" Source="cat_var_1b"/>
    </Resources>

	<Class Id="clsHero">
		<Hero Speed="84" Direction="0,0" Deceleration="0">
            <Include File="includeSkeletonHeroMotions.xml"/>
		
<!-- Init Vars -->

         	<Do InProgress="true" Action="
                @heroDepartPointX=0;
                @heroDepartPointY=0;
                @heroDestPointX=0;
                @heroDestPointY=0"/>
                
            <!-- enter -->
            <BoolTrigger Condition="this:Enter" EnterAction="setHeroEnter.Start()" Group="sttHeroStates">
                <Image TextureId="txrHeroExit" Bounds="-4, -10, 40, 33"/>
                <SequenceSet Id="setHeroEnter">
                    <Do Action="hero.StartTransaction()"/>
                    <Delay Duration="0.3" />
                    <NumAnimation Target="hero.X,hero.Y,hero.Opacity" From="@heroDepartPointX,@heroDepartPointY,1" To="@heroDestPointX,@heroDestPointY,0" Duration="0.5" InProgress="true" RepeatCount="1" Fill="End"/>
                    <Delay Duration="1.5"/>
                    <Do Action="hero.EndTransaction();this:-Enter"/>
                </SequenceSet>
            </BoolTrigger>            

            <!-- electic shock -->
            <BoolTrigger Condition="this:ElecticShock" EnterAction="anmElecticShock.Start();this:+GottaDamage" ExitAction="anmElecticShockEnd.Start()" />
            <NumAnimation Id="anmElecticShock" From="-1" To="1" Target="this.Rotation" Duration="0.05" Autoreverse="true" RepeatCount="0" />
            <SequenceSet Id="anmElecticShockEnd">
                <Delay Duration="2" />
                <Do Action="anmElecticShock.Stop();this:-GottaDamage" />
                <NumAnimation From="0" To="0" Target="this.Rotation" Duration="0.1" Autoreverse="true" RepeatCount="1" />
            </SequenceSet>

            <!-- explosion : wait -->
            <BoolTrigger Condition="this:WaitingExplosion" Group="sttHeroStates">
                <!--bolbex<Image TextureId="txrHeroWaitingExplosion" Bounds="-3, -14, 40, 38"/>-->
                <Image TextureId="txrHeroWaitingExplosion" Bounds="-4, -10, 40, 33"/>
            </BoolTrigger>

            <!-- explosion : good one!-->
            <BoolTrigger Condition="this:GoodExplosion" Group="sttHeroStates">
                <!--bolbex<Image TextureId="txrHeroWaitingExplosion" Bounds="-3, -14, 40, 38"/>-->
                <Image TextureId="txrHeroExplode" Bounds="-4, -10, 40, 33"/>
            </BoolTrigger>

            <!-- dying -->
			<BoolTrigger Condition="this.IsDead" EnterAction="setHeroDying.Start()" StayTriggered="true" Group="sttHeroStates">
				<Image Id="imgHeroDying" TextureId="txrHeroDying" Bounds="-4, -10, 40, 33"/>
				<SequenceSet Id="setHeroDying">
					<Do Action="this.StartTransaction()"/>
					<ParallelSet>
						<Sound FileId="sndHeroDying" Volume="0.5" Pitch="0" Pan="0" InProfress="true"/>
						<NumAnimation Duration="0.1" Target="imgHeroDying.Opacity" Autoreverse="true" From="1" To="0" RepeatCount="5"/>
					</ParallelSet>
					<Do Action="this.EndTransaction()"/>
					<Do Action="system.EndCurrentLevel()"/>
				</SequenceSet>
			</BoolTrigger>

            <!-- gotta damage -->
            <BoolTrigger Condition="this:GottaDamage" EnterAction="setHeroGottaDamage.Start()" StayTriggered="false" Group="sttHeroStates">
                <Image Id="imgHeroGottaDamage" TextureId="txrHeroGottaDamage" Bounds="-4, -10, 40, 33"/>
            </BoolTrigger>
            <SequenceSet Id="setHeroGottaDamage">
                <NumAnimation Target="imgHeroGottaDamage.Height" From="0" To="-1" Duration="0.2" IsDelta="true" Autoreverse="true" Fill="Reset" RepeatCount="5" />
                <Delay Duration="1" />
            </SequenceSet>

            <!-- eating -->
			<BoolTrigger Condition="this:Eating" EnterAction="setHeroEating.Start()" StayTriggered="false" Group="sttHeroStates">
                <!--<Image TextureId="txrHeroEating" Bounds="-4, -18, 40, 41"/>-->
                <Sprite Id="sprHeroEating" TextureId="txrHeroEating" Bounds="-4, -18, 40, 41" FrameBounds="0,0,40,41" />
                <!--<BoolTrigger Property="zzzsprHeroEating.InProgress" ExitAction="this:-Eating" />-->
                <SequenceSet Id="setHeroEating">
                    <ParallelSet>
                        <NumAnimation From="0" To="1" Duration="0.2" Autoreverse="false" Target="sprHeroEating.CurrentFrame" RepeatCount="1.5" Fill="End"/>
				        <RandomSet>
					        <Sound FileId="sndHeroEating1" Volume="0.5" Pitch="0"/>
					        <Sound FileId="sndHeroEating2" Volume="0.5" Pitch="0"/>
					        <Sound FileId="sndHeroEating3" Volume="0.5" Pitch="0"/>
					        <Sound FileId="sndHeroEating4" Volume="0.5" Pitch="0"/>
					        <Sound FileId="sndHeroEating1" Volume="0.5" Pitch="0.3"/>
					        <Sound FileId="sndHeroEating2" Volume="0.5" Pitch="0.3"/>
					        <Sound FileId="sndHeroEating3" Volume="0.5" Pitch="0.3"/>
					        <Sound FileId="sndHeroEating4" Volume="0.5" Pitch="0.3"/>
				        </RandomSet>
                    </ParallelSet>
                    <Do Action="this:-Eating" />
                </SequenceSet>
			</BoolTrigger>

            <!-- default -->
			<BoolTrigger Group="sttHeroStates">
                <Image TextureId="txrHeroDefault" Bounds="-4, -10, 40, 33"/>
				<!--bolbex:<Image TextureId="txrHeroDefault" Bounds="-3, -14, 40, 38"/>-->
                <!--<Image TextureId="blank" BackColor="#00FF00" Opacity="0.5"/>-->
			</BoolTrigger>

<!-- foley -->

            <BoolTrigger Condition="hero:bounce" EnterAction="this_setHeroBounce.Start()"/>
            <RandomSet Id="this_setHeroBounce">
				<Sound FileId="sndHeroBounce1" Volume="0.5" Pitch="0"/>
				<Sound FileId="sndHeroBounce2" Volume="0.5" Pitch="0"/>
				<Sound FileId="sndHeroBounce1" Volume="0.5" Pitch="-0.3"/>
				<Sound FileId="sndHeroBounce2" Volume="0.5" Pitch="-0.3"/>
			</RandomSet>

		</Hero>
		
	</Class>


</Include>






















