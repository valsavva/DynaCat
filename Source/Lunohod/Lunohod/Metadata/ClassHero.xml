<!--<Level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="file:///D:/Lunohod/Documentation/schema0.xsd" Name="S02LXX_Trenazher" Bounds="0, 0, 480, 320">-->
<Include>
    <Include File="ClassSFX.xml" />
    <Class Id="clsHero">
		<Hero Speed="0" Direction="0,0" Deceleration="0">
            <Group Id="SFX" Class="clsSFX" />
            
            <Include File="includeSkeletonHeroMotions.xml"/>
		
<!-- Init -->

         	<Do InProgress="true" RepeatCount="1"  Action="
                @heroDepartPointX=0;
                @heroDepartPointY=0;
                @heroDestPointX=0;
                @heroDestPointY=0;
                hero.Width=31;
                hero.Height=24"/>
            
<!-- States 

            hero.IsDead         : /major/ hero dying
            sttExit             : /major/ hero reached exit
            sttElecticShock     : /major/ gotta electic shock
            sttEating           : /major/ eating
            sttGottaDamage      : /major/ gotta damage
            
            sttWaitingExplosion : /minor/ hero fire a bomb
            sttGoodExplosion    : /minor/ explosion - good one!
            sttBadExplosion     : /minor/ explosion - bad
            OnOilMotion         : /minor/ hero on the Oil
            Magneted            : /minor/ beamed by magnet waves
            -->
            

            <!-- hero.IsDead : /major/ hero dying -->
            <BoolTrigger Condition="hero.IsDead" 
                         EnterAction="hero.SetTransaction(false, false, false);
                         anmHeroDying.Start()"
                         StayTriggered="true"
                         Group="sttHeroStates">
                <Image Id="imgHeroDying" TextureId="txrHeroDying" Bounds="-33, -46, 100, 100"/>
            </BoolTrigger>
            
            <SequenceSet Id="anmHeroDying">
                <NumAnimation Duration="0.1" Target="imgHeroDying.Opacity" Autoreverse="true" From="1" To="0" RepeatCount="5"/>
                <Do Action="system.StartScreen('ScreenLevelFailed.xml')"/>
            </SequenceSet>
            
            
            <!-- sttExit : /major/ hero reached exit -->
            <BoolTrigger Condition="hero:sttExit" 
                         EnterAction="hero.SetTransaction(false, false, false);
                         anmHeroExit.Start()"
                         StayTriggered="true"
                         Group="sttHeroStates">
                <Image TextureId="txrHeroExit" Bounds="-33, -46, 100, 100"/>
            </BoolTrigger>
            
            <SequenceSet Id="anmHeroExit" RepeatCount="1">
                <Delay Duration="0.3" />
                <!--<Do Action="hero.Depth=exit.Depth+0.1" />-->
                <NumAnimation Target="hero.X,hero.Y,hero.Opacity" From="@heroDepartPointX,@heroDepartPointY,1" To="@heroDestPointX,@heroDestPointY,0" Duration="0.5" InProgress="true" RepeatCount="1" Fill="End"/>
                <Do Action="hero.X=-7777777;hero.Y=-7777777" />
            </SequenceSet>
                        

            <!-- sttElecticShock : /major/ gotta electic shock -->
            <BoolTrigger Condition="hero:sttElecticShock" 
                         EnterAction="anmElecticShock.Start();
                         hero:-sttEating;hero:-sttGoodExplosion"
                         ExitAction="anmElecticShock.Stop()"
                         Group="sttHeroStates">
                <Sprite Id="sprHeroGottaEShock" TextureId="txrHeroGottaEShock" Bounds="-33, -46, 100, 100"  FrameBounds="0,0,100,100" FrameCount="3"/>
            </BoolTrigger>

            <SequenceSet Id="anmElecticShock" RepeatCount="1">
                <NumAnimation From="0" To="2" Duration="0.5" Target="sprHeroGottaEShock.CurrentFrame" RepeatCount="1" Fill="End"/>
                <Do Action="hero:-sttElecticShock" />
            </SequenceSet>

            <!-- sttGottaDamage : /major/ gotta damage -->
            <BoolTrigger Condition="hero:sttGottaDamage"
                         EnterAction="anmHeroGottaDamage.Play();
                         hero:-sttEating;hero:-sttGoodExplosion"
                         Group="sttHeroStates">
                <Sprite Id="this_shtHeroGottaDamage" TextureId="txrHeroGottaDamage" Bounds="-33, -46, 100, 100" FrameBounds="0,0,100,100" FrameCount="5"/>
                <!--<NumAnimation From="0" To="4" Duration="2.5" Target="this_shtHeroGottaDamage.CurrentFrame" RepeatCount="0" Fill="End" InProgress="true"/>-->
            </BoolTrigger>
            
            <Sprite Id="this_sprBlowFlash1" TextureId="txrBlowFlash1" Bounds="-13,-15,57,56" FrameBounds="0,0,57,56" FrameCount="3" Enabled="false" Depth="0.08" />
            <Sprite Id="this_sprBlowFlash2" TextureId="txrBlowFlash2" Bounds="-15,-22,64,64" FrameBounds="0,0,64,64" FrameCount="3" Enabled="false" Depth="0.08" />
            <Sprite Id="this_sprBlowFlash3" TextureId="txrBlowFlash3" Bounds="-10,-12,50,54" FrameBounds="0,0,50,54" FrameCount="3" Enabled="false" Depth="0.08" />
            <Sprite Id="this_sprBlowFlash4" TextureId="txrBlowFlash4" Bounds="-3,-7,37,35" FrameBounds="0,0,37,35" FrameCount="3" Enabled="false" Depth="0.08" />

            <ParallelSet Id="anmHeroGottaDamage" RepeatCount="1">
                <SequenceSet RepeatCount="1">
                    <Delay Duration="0.4" />
                    <Do Action="this_shtHeroGottaDamage.CurrentFrame=system.Rnd(0,4)" />
                    <Delay Duration="0.4" />
                    <Do Action="hero:-sttGottaDamage"/>
                </SequenceSet>
                <RandomSet RepeatCount="1">
                    <SequenceSet RepeatCount="1">
                        <Do Action="@this_flashDX=system.Rnd(-16,16);@this_flashDY=system.Rnd(-12,12)" />
                        <Do Action="this_sprBlowFlash1.Enable();
                            this_sprBlowFlash1.X=this_sprBlowFlash1.X+@this_flashDX;
                            this_sprBlowFlash1.Y=this_sprBlowFlash1.Y+@this_flashDY" />
                        <NumAnimation From="0" To="2" Duration="0.3" Target="this_sprBlowFlash1.CurrentFrame" RepeatCount="1" Fill="End"/>
                        <Do Action="this_sprBlowFlash1.Disable();
                            this_sprBlowFlash1.X=this_sprBlowFlash1.X-@this_flashDX
                            this_sprBlowFlash1.Y=this_sprBlowFlash1.Y-@this_flashDY" />

                        <Do Action="@this_flashDX=system.Rnd(-16,16);@this_flashDY=system.Rnd(-12,12)" />
                        <Do Action="this_sprBlowFlash4.Enable();
                            this_sprBlowFlash4.X=this_sprBlowFlash4.X+@this_flashDX;
                            this_sprBlowFlash4.Y=this_sprBlowFlash4.Y+@this_flashDY" />
                        <NumAnimation From="0" To="2" Duration="0.2" Target="this_sprBlowFlash4.CurrentFrame" RepeatCount="1" Fill="End"/>
                        <Do Action="this_sprBlowFlash4.Disable();
                            this_sprBlowFlash4.X=this_sprBlowFlash4.X-@this_flashDX
                            this_sprBlowFlash4.Y=this_sprBlowFlash4.Y-@this_flashDY" />
                    </SequenceSet>
                
                    <SequenceSet RepeatCount="1">
                        <Do Action="@this_flashDX=system.Rnd(-16,16);@this_flashDY=system.Rnd(-12,12)" />
                        <Do Action="this_sprBlowFlash2.Enable();
                            this_sprBlowFlash2.X=this_sprBlowFlash2.X+@this_flashDX;
                            this_sprBlowFlash2.Y=this_sprBlowFlash2.Y+@this_flashDY" />
                        <NumAnimation From="0" To="2" Duration="0.5" Target="this_sprBlowFlash2.CurrentFrame" RepeatCount="1" Fill="End"/>
                        <Do Action="this_sprBlowFlash2.Disable();
                            this_sprBlowFlash2.X=this_sprBlowFlash2.X-@this_flashDX
                            this_sprBlowFlash2.Y=this_sprBlowFlash2.Y-@this_flashDY" />
                    </SequenceSet>
                
                    <SequenceSet RepeatCount="1">
                        <Do Action="@this_flashDX=system.Rnd(-16,16);@this_flashDY=system.Rnd(-12,12)" />
                        <Do Action="this_sprBlowFlash3.Enable();
                            this_sprBlowFlash3.X=this_sprBlowFlash3.X+@this_flashDX;
                            this_sprBlowFlash3.Y=this_sprBlowFlash3.Y+@this_flashDY" />
                        <NumAnimation From="0" To="2" Duration="0.5" Target="this_sprBlowFlash3.CurrentFrame" RepeatCount="1" Fill="End"/>
                        <Do Action="this_sprBlowFlash3.Disable();
                            this_sprBlowFlash3.X=this_sprBlowFlash3.X-@this_flashDX
                            this_sprBlowFlash3.Y=this_sprBlowFlash3.Y-@this_flashDY" />             
                    </SequenceSet>

                </RandomSet>
            </ParallelSet>
            
            <!-- sttEating : /major/ eating -->
            <BoolTrigger Condition="hero:sttEating" 
                         EnterAction="anmHeroEating.Start()" 
                         ExitAction="anmHeroEating.Stop()"
                         Group="sttHeroStates">
                <Sprite Id="sprHeroEating" TextureId="txrHeroEating" Bounds="-33, -46, 100, 100"  FrameBounds="0,0,100,100" FrameCount="3"/>
            </BoolTrigger>
            <SequenceSet Id="anmHeroEating" RepeatCount="1">
                <NumAnimation From="0" To="2" Duration="0.5" Target="sprHeroEating.CurrentFrame" RepeatCount="1" Fill="End"/>
                <RandomSet>
                    <Delay Duration="0.1" />
                    <Delay Duration="0.25" />
                    <Delay Duration="0.4" />
                </RandomSet>
                <Do Action="hero:-sttEating" />
            </SequenceSet>


            <!-- sttWaitingExplosion : /minor/ hero fire a bomb -->
            <BoolTrigger Condition="hero:sttWaitingExplosion" 
                         Group="sttHeroStates">
                <Image TextureId="txrHeroWaitingExplosion" Bounds="-33, -46, 100, 100"/>
            </BoolTrigger>

            <!-- sttGoodExplosion : /minor/ explosion - good one! -->
            <BoolTrigger Condition="hero:sttGoodExplosion" 
                         EnterAction="anmGoodExplosion.Start()" 
                         ExitAction="anmGoodExplosion.Stop()"
                         Group="sttHeroStates">
                <Image TextureId="txrHeroGoodExplosion" Bounds="-33, -46, 100, 100"/>
            </BoolTrigger>
            <SequenceSet Id="anmGoodExplosion">
                <Delay Duration="1" />
                <Do Action="hero:-sttGoodExplosion" />
            </SequenceSet>

            <!-- sttBadExplosion : /minor/ explosion - bad -->
            <BoolTrigger Condition="hero:sttBadExplosion" 
                         EnterAction="anmBadExplosion.Start()"
                         ExitAction="anmBadExplosion.Stop()"
                         Group="sttHeroStates">
                <Image TextureId="txrHeroBadExplosion" Bounds="-33, -46, 100, 100"/>
            </BoolTrigger>
            <SequenceSet Id="anmBadExplosion">
                <Delay Duration="1" />
                <Do Action="hero:-sttBadExplosion" />
            </SequenceSet>            
            
            <!-- OnOilMotion : /minor/ hero on the Oil -->
            <BoolTrigger Condition="hero:OnOilMotion" 
                         Group="sttHeroStates" >
                <Sprite TextureId="txrHeroSurprised" Bounds="-33, -46, 100, 100"  FrameBounds="0,0,100,100" FrameCount="2">
                    <NumAnimation From="0" To="1" Duration="0.4" Target="CurrentFrame" RepeatCount="0" Fill="End" InProgress="true"/>
                </Sprite>
            </BoolTrigger>
 
            <!-- Magneted : /minor/ beamed by magnet waves -->
            <BoolTrigger Condition="hero:Magneted" Group="sttHeroStates" >
                <Sprite Id="shtHeroSurprised" TextureId="txrHeroSurprised" Bounds="-33, -46, 100, 100" FrameBounds="0,0,100,100" FrameCount="2">
                    <NumAnimation From="0" To="1" Duration="0.4" Target="CurrentFrame" RepeatCount="0" Fill="End" InProgress="true"/>
                </Sprite>
            </BoolTrigger>

            <BoolTrigger Condition="hero:Magneted and not hero:Magneting" 
                         EnterAction="setHeroSurQuake.Start()" 
                         ExitAction="setHeroSurQuake.Stop();setHeroSurQuakeEnd.Start()" />
            <SequenceSet Id="setHeroSurQuake" RepeatCount="0">
                <NumAnimation Target="shtHeroSurprised.X" From="0" To="-3" Duration="0.08" Fill="End" IsDelta="true" RepeatCount="1"/>
                <NumAnimation Target="shtHeroSurprised.X" From="-3" To="3" Duration="0.08" Fill="End" IsDelta="true" Autoreverse="true" RepeatCount="0"/>
            </SequenceSet>

            <NumAnimation Id="setHeroSurQuakeEnd" Target="shtHeroSurprised.X" From="shtHeroSurprised.X" To="-33" Duration="0.08" Fill="End" IsDelta="false" RepeatCount="1"/>

            
            <!-- default -->
			<BoolTrigger Group="sttHeroStates">
                <Image TextureId="txrHeroDefault" Bounds="-33, -46, 100, 100"/>
                <!--<Group BackColor="#0000FF">
                    <Image TextureId="blank"/>
                </Group>-->
			</BoolTrigger>

            
<!-- foley -->
            
            <!-- hero dying -->
            <BoolTrigger Condition="hero.IsDead"
                         EnterAction="sfxHeroDying.Start()">
            </BoolTrigger>
            
            <RandomSet Id="sfxHeroDying" RepeatCount="1">
                <Sound FileId="sndHeroDying" Volume="0.5" Pitch="0" Pan="0"/>
                <Sound FileId="sndHeroDying" Volume="0.5" Pitch="-0.03" Pan="0"/>
            </RandomSet>
                        
            <!-- Teleport -->

            <BoolTrigger Condition="hero:sttPortIn" 
                         EnterAction="sfxPortIn.Start()" />
            
            <SequenceSet Id="sfxPortIn" RepeatCount="1">
                <Sound FileId="sndTeleportIn" Volume="0.5" Pitch="0"/>
            </SequenceSet>

            <BoolTrigger Condition="hero:sttPortCont" 
                         EnterAction="sfxPortCont.Play()" 
                         ExitAction="sfxPortCont.Pause()"/>
            <SequenceSet Id="sfxPortCont">
                <Sound FileId="sndTeleportCont" Volume="0.5" Pitch="0" IsLooped="true"/>
            </SequenceSet>

            <BoolTrigger Condition="hero:sttPortOut" 
                         EnterAction="sfxPortOut.Start()"/>
            <RandomSet Id="sfxPortOut">
                <Sound FileId="sndTeleportOut" Volume="0.5" Pitch="0"/>
                <Sound FileId="sndTeleportOut" Volume="0.5" Pitch="-0.1"/>
                <Sound FileId="sndTeleportOut" Volume="0.5" Pitch="0.1"/>
            </RandomSet>

        </Hero>
		
	</Class>

</Include>
