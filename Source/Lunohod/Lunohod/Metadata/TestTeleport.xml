<?xml version="1.0" encoding="utf-8" ?>
<Level Name="TextText" Bounds="0,0,480,320">

	<Resources RootFolder="Global">
		<Texture Id="blank" Source="blank" />
		<Font Id="SystemFont" Source="SystemFont" />
	</Resources>
	
	<Include File="Textures.xml" />

	<Layer Id="background" BackColor="#FFFFFFFF">
	</Layer>

	<Layer Id="action" BackColor="#FFFFFFFF">
		<Block Id="blk1" Bounds="0,0,480,1" Edges="Bounce" />
		<Block Id="blk2" Bounds="480,0,1,320" Edges="Bounce" />
		<Block Id="blk3" Bounds="0,320,480,1" Edges="Bounce" />
		<Block Id="blk4" Bounds="0,0,1,320" Edges="Bounce" />

		<Tower Bounds="0,0,35,35" SignalSpeed="400"/>
		<Hero Id="hero" Bounds="35,150,50,50" Speed="150">
			<Image TextureId="cursor_solid_50x50_green" />
		</Hero>

		<Tower Bounds="0,0,35,35" SignalSpeed="1800"/>


		<!-- Два "телепорта" -->
		<Image TextureId="cursor_50x50_green" Bounds="20,20,80,80">
			<Group Id="grpPort1In" Bounds="20,20,20,20"/>
		</Image>
		<Image TextureId="cursor_50x50_purple" Bounds="380,20,80,80" />
		
		<!-- Этот сэт производит переход из одного "телепорта" в другой -->
		<!-- По умолчанию сэты не запущены - это будет сделано тригером. -->
		<SequenceSet Id="setTeleportClassic">
			<!-- У нас есть транзакции теперь. Когда транзакция начинается, система перестает двигать героя. -->
			<Do Action="hero.StartTransaction()"/>
			<!-- Герой исчезает -->
			<NumAnimation Target="hero.Opacity" From="1" To="0" Duration="2" RepeatCount="1" Fill="End"/>
			<!-- Герой перемещается -->
			<NumAnimation Target="hero.X,hero.Y" From="20,20" To="395,35" Duration="0.001" RepeatCount="1" Fill="End"/>
			<!-- Герой появляется -->
			<NumAnimation Target="hero.Opacity" From="0" To="1" Duration="2" RepeatCount="1" Fill="End"/>
			<!-- Ставим новое направление герою -->
			<Do Action="hero.SetDirection(0,1)"/>
			<!-- Заканчиваем транзакцию -->
			<Do Action="hero.EndTransaction()"/>
		</SequenceSet>

		<!-- Просто триггер отслеживающий вхождение героя внутрь телепорта и запускающий переход -->		
		<IntersectionTrigger ObjectId1="hero" ObjectId2="grpPort1In" EnterAction="setTeleportClassic.Start()"/>

		<!-- ************************************************************************************ -->
		<!-- ************************************************************************************ -->
		<!-- ************************************************************************************ -->

		<!-- Еще пример. Заодно демонстрируем мощь классов с параметрами!! -->
		<Class Id="clsTeleportGhost">
			<!-- Этот сэт производит переход из одного "телепорта" в другой -->
			<!-- По умолчанию сэты не запущены - это будет сделано тригером. -->
			<SequenceSet>
				<!-- У нас есть транзакции теперь. Когда транзакция начинается, система перестает двигать героя. -->
				<Do Action="hero.StartTransaction()"/>
				<!-- Герой бледнеет -->
				<NumAnimation Target="hero.Opacity" From="1" To="0.3" Duration="0.7" RepeatCount="1" Fill="End"/>
				<!-- Герой перемещается вращаясь как бешеный -->
				<ParallelSet>
					<NumAnimation Target="hero.X,hero.Y" Duration="1.5" RepeatCount="1" Fill="End">
						<!-- параметры!! -->
						<KeyFrame Time="0" Value="@fromX,@fromY" Smoothness="Smooth"/>
						<KeyFrame Time="0.5" Value="30,80" Smoothness="Smooth"/>
						<KeyFrame Time="1" Value="430,80" Smoothness="Smooth"/>
						<!-- параметры!! -->
						<KeyFrame Time="1.5" Value="@toX,@toY" Smoothness="Smooth"/>
					</NumAnimation>
					<NumAnimation Target="hero.Rotation" From="0" To="360" Duration="0.3" RepeatTime="1.5" Fill="Reset"/>
				</ParallelSet>
				<!-- Герой появляется -->
				<NumAnimation Target="hero.Opacity" From="0.3" To="1" Duration="0.7" RepeatCount="1" Fill="End"/>
				<!-- Ставим новое направление герою -->
				<Do Action="hero.SetDirection(0,-1)"/>
				<!-- Заканчиваем транзакцию -->
				<Do Action="hero.EndTransaction()"/>
			</SequenceSet>
		</Class>
		
		<!-- Два "телепорта" -->
		<Image Id="imgPort2In" TextureId="cursor_50x50_green" Bounds="20,240,80,80">
			<Group Id="grpPort2In" Bounds="20,20,20,20"/>
		</Image>
		<Image Id="imgPort3In" TextureId="cursor_50x50_green" Bounds="140,135,80,80">
			<NumAnimation Target="Y" From="-20" To="120" IsDelta="true" Autoreverse="true" Duration="1" InProgress="true"/>
			<Group Id="grpPort3In" Bounds="20,20,20,20"/>
		</Image>
		<Image TextureId="cursor_50x50_purple" Bounds="380,240,80,80"/>

		<!-- Тут мы используем мощь классов. Программируем переход между двумя парами порталов, используя класс. -->		
		<SequenceSet Id="setTeleportGhost1" Class="clsTeleportGhost" ClassParams="@fromX=imgPort2In.X,@fromY=imgPort2In.Y,@toX=395,@toY=255" />
		<IntersectionTrigger ObjectId1="hero" ObjectId2="grpPort2In" EnterAction="setTeleportGhost1.Start()"/>

		<SequenceSet Id="setTeleportGhost2" Class="clsTeleportGhost" ClassParams="@fromX=imgPort3In.X,@fromY=imgPort3In.Y,@toX=395,@toY=255" />
		<IntersectionTrigger ObjectId1="hero" ObjectId2="grpPort3In" EnterAction="setTeleportGhost2.Start()"/>

		<!-- Exit! -->		
		<Image Id="imgExit" TextureId="_E_" Bounds="215,135,50,50"/>
		<IntersectionTrigger ObjectId1="hero" ObjectId2="imgExit" Value="400" EnterAction="system.EndLevel()" />
	</Layer>

	<Include File="Dashboard.xml" />

</Level>

