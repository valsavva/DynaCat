<?xml version="1.0" encoding="utf-8"?>
<Level Name="AnimationSamples.xml" Bounds="0,0,480,320">
	<LevelSettings
			Dificulty="1"
			BombCount="10"
			ExplosionClass="clsExplosion"
	/>

	<Resources RootFolder="Global">
		<Texture Id="blank" Source="blank" />
		<Font Id="SystemFont" Source="SystemFont" />
		<Texture Id="chargers" Source="ch"/>
		<Texture Id="circle" Source="wave0200" />
		<Texture Id="txrExplosion" Source="explosion"/>
	</Resources>

	<Include File="Textures.xml" />
	<Include File="ClassCursor.xml" />

	<Class Id="clsExplosion">
		<Explosion Bounds="0,0,84,84" Ranges="boomVeryClose=50,boomClose=100,boomFar=150,boomVeryFar=200">
			<Image Id="this_imgBomb" Bounds="32,32,20,20" TextureId="cursor_solid_10x10_black_red" Opacity="0" />
			<Sprite Id="this_sprExplosion" TextureId="txrExplosion" FrameBounds="0,0,84,84" FrameCount="12" Enabled="false"/>

			<SequenceSet InProgress="true">
				<NumAnimation Target="this_imgBomb.Opacity" From="1" To="0" Duration="0.3" Autoreverse="true" RepeatCount="2"/>
				<Do Action="this_imgBomb.Disable()"/>
				<Do Action="this_sprExplosion.Enable()"/>
				<NumAnimation From="0" To="11" Duration="0.5" Autoreverse="false" Target="this_sprExplosion.CurrentFrame" RepeatCount="1"/>
				<Do Action="this.Disable()"/>
			</SequenceSet>
		</Explosion>
	</Class>
	
	<Class Id="clsWall">
		<Block Edges="Stick">
			<BoolTrigger Condition="this:intersectExplosion" StayTriggered="true" Group="wallStates">
				<Image TextureId="blank" BackColor="#FF0000"/>
				<SequenceSet Id="this_setDestroyWall" InProgress="true">
					<NumAnimation Target="this.Opacity" From="1" To="0" Duration="0.1" Autoreverse="true" RepeatCount="10"/>
					<Do Action="this.Disable()"/>
				</SequenceSet>
			</BoolTrigger>
			<BoolTrigger Id="default" Group="wallStates">
				<Image TextureId="blank" BackColor="#000000"/>
			</BoolTrigger>
		</Block>
	</Class>
	
    <Layer Id="background" BackColor="#FFFFFFFF">
        <Image TextureId="white_clear" Bounds="0, 0, 480, 320" Stretch="true" Opacity="1" />
        <Image TextureId="grid_480x320" Bounds="0, 0, 480, 320" Stretch="false" Opacity="1"/>
    </Layer>

	<Layer Id="action" BackColor="#FFFFFFFF">
		<Tower Bounds="0,0,35,35" SignalSpeed="800"/>	
		<Hero Id="hero" Bounds="50,150,50,50" Class="clsHeroCursor" />
		
		<Block Id="blk1" Bounds="0,0,480,1" Edges="Bounce" />
		<Block Id="blk2" Bounds="480,0,1,320" Edges="Bounce" />
		<Block Id="blk3" Bounds="0,320,480,1" Edges="Bounce" />
		<Block Id="blk4" Bounds="0,0,1,320" Edges="Bounce" />
		
		<!-- This is the "mine" -->
		<Image Id="imgMine" TextureId="cursor_solid_50x50_red" Bounds="250,150,50,50"/>
		<!-- This represents the explosion radius -->
		<Image Id="imgExplosion" TextureId="circle" Bounds="175,75,200,200" Enabled="false"/>

		<!-- A wall -->		
		<Block Id="blkWall001" Bounds="350,50,50,200" Class="clsWall"/>
		
		<!-- This will trigger the whole explosion once the hero steps on the "mine" -->
		<!-- EnterAction - Start the iterator; enable the explosion image -->
		<IntersectionTrigger Id="trgMine" ObjectId1="imgMine" ObjectId2="hero"
			EnterAction="imgExplosion.Enable();setExplosion.Start()">
			
			<SequenceSet Id="setExplosion">
				<!-- We iterate through all Elements to find which ones were affected by the explosion -->
				<Iterator Id="itr" TypeFilter="Element">
					<!-- We want normal objects to "explode" by measuring the distance between the mine and the object -->
					<DistanceTrigger ObjectId1="imgMine" ObjectId2="itr" Value="75" Action="itr:distanceExplosion" />
					<!-- But for walls we want to use intersection (center of a long wall can be too far from the mine) -->
					<!-- TODO: We need an intersectin trigger between circles and rectangles -->
					<IntersectionTrigger ObjectId1="imgExplosion" ObjectId2="itr" Action="itr:intersectExplosion" />
				</Iterator>
				<!-- Disable the trigger (we won't need it anymore) -->
				<Do Action="trgMine.Disable()"/>
			</SequenceSet>
		</IntersectionTrigger>

	</Layer>

	<Include File="Dashboard.xml" />	

</Level>

