<?xml version="1.0" encoding="utf-8" ?>
<!--<Level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="file:///D:/Lunohod/Documentation/schema0.xsd" Name="AlphaTest5ME" Bounds="0, 0, 480, 320">-->
<Include>
    <Resources RootFolder="Textures">
        <Texture Id="txr_excavator_hor_magnet" Source="excavator_hor_magnet" />
        <Texture Id="txr_excavator_hor" Source="excavator_hor" />
        <Texture Id="txr_excavator_vert_magnet" Source="excavator_vert_magnet" />
        <Texture Id="txr_excavator_vert" Source="excavator_vert" />
        <Texture Id="txr_magnet_waves_left" Source="magnet_waves_left" />
        <Texture Id="txr_magnet_waves_up" Source="magnet_waves_up" />
        <Texture Id="txr_magnet_waves_right" Source="magnet_waves_right" />
        <Texture Id="txr_magnet_waves_down" Source="magnet_waves_down" />
    </Resources>

    <Class Id="clsExcavator">
        <Group>
            <Do Action="@this_dirX=@paramDirX;@this_dirY=@paramDirY;" InProgress="true" />

            <!-- init horizontal, shooting right -->
            <BoolTrigger Id="this_init1" Condition="@this_dirX==1">
                <Do Action="this_grpMagnetWaves.SetBounds(this_blkExcavator.X+60, 7, 500, 26)" RepeatCount="1" InProgress="true"/>
                <Do Action="this_init1.Disable()" />
            </BoolTrigger>
            
            <!-- init horizontal, shooting left -->
            <BoolTrigger Id="this_init2" Condition="@this_dirX==-1">
                <Do Action="this_grpMagnetWaves.SetBounds(this_blkExcavator.X-500, 7, 500, 26)" RepeatCount="1" InProgress="true"/>
                <Do Action="this_init2.Disable()" />
            </BoolTrigger>
            
            <!-- init vertical, shooting down -->
            <BoolTrigger Id="this_init3" Condition="@this_dirY==1">
                <Do Action="this_grpMagnetWaves.SetBounds(7, this_blkExcavator.Y+60, 26, 300)" RepeatCount="1" InProgress="true"/>
                <Do Action="this_init3.Disable()" />
            </BoolTrigger>
            
            <!-- init vertical, shooting up -->
            <BoolTrigger Id="this_init4" Condition="@this_dirY==-1">
                <Do Action="this_grpMagnetWaves.SetBounds(7, this_blkExcavator.Y-300, 26, 300)" RepeatCount="1" InProgress="true"/>
                <Do Action="this_init4.Disable()" />
            </BoolTrigger>
			
            <!-- excavator -->
            
            <Block Id="this_blkExcavator" Edges="Stick">
                <BoolTrigger Condition="@this_dirX==1" Group="this_sttExcavatorView">
                    <Image TextureId="txr_excavator_hor_magnet" FlipEffects="Horizontally" />
                </BoolTrigger>
                <BoolTrigger Condition="@this_dirX==-1" Group="this_sttExcavatorView">
                    <Image TextureId="txr_excavator_hor_magnet"/>
                </BoolTrigger>
                <BoolTrigger Condition="@this_dirY==1" Group="this_sttExcavatorView">
                    <Image TextureId="txr_excavator_vert_magnet"/>
                </BoolTrigger>
                <BoolTrigger Condition="@this_dirY==-1" Group="this_sttExcavatorView">
                    <Image TextureId="txr_excavator_vert_magnet"  FlipEffects="Vertically"/>
                </BoolTrigger>
            </Block>
            
            <!-- waves -->
    
            <Group Id="this_grpMagnetWaves">
                <SequenceSet RepeatCount="0" InProgress="true" >
                    <Do Action="this:+IsBeaming" />
                    <NumAnimation Target="this_grpMagnetWaves.Opacity" Autoreverse="true" From="0.8" To="0.3" Duration="0.1" Smoothing="Smooth" RepeatCount="20"/>
                    <Do Action="this_grpMagnetWaves.Opacity=0;this:-IsBeaming;hero:-Magneted;hero:-Magneting;this_anmSetHeroOnHor.Pause();this_anmSetHeroOnVert.Pause()" />
                    <Delay Duration="4" />
                </SequenceSet>
                <BoolTrigger Condition="@this_dirX==1" Group="this_sttWavesView">
                    <Image TextureId="txr_magnet_waves_right" StretchMode="Tile"/>
                </BoolTrigger>
                <BoolTrigger Condition="@this_dirX==-1" Group="this_sttWavesView">
                    <Image TextureId="txr_magnet_waves_left" StretchMode="Tile"/>
                </BoolTrigger>
                <BoolTrigger Condition="@this_dirY==1" Group="this_sttWavesView">
                    <Image TextureId="txr_magnet_waves_down" StretchMode="Tile"/>
                </BoolTrigger>
                <BoolTrigger Condition="@this_dirY==-1" Group="this_sttWavesView">
                    <Image TextureId="txr_magnet_waves_up" StretchMode="Tile"/>
                </BoolTrigger>
                
            </Group>
            
            <IntersectionTrigger ObjectId1="this_grpMagnetWaves" ObjectId2="hero">
                <BoolTrigger Condition="this:IsBeaming 
                             and (@this_dirX==1 or @this_dirX==-1) 
                             and not hero:Magneted 
                             and not hero.IsDead 
                             and not hero:sttExit" 
                             EnterAction="hero:+Magneted;this_anmSetHeroOnHor.Start();
                             @heroTunnelngX=@this_dirX;@heroTunnelngY=0"/>
            </IntersectionTrigger>
            
            <IntersectionTrigger ObjectId1="this_grpMagnetWaves" ObjectId2="hero">
                <BoolTrigger Condition="this:IsBeaming 
                             and (@this_dirY==1 or @this_dirY==-1) 
                             and not hero:Magneted 
                             and not hero.IsDead 
                             and not hero:sttExit" 
                             EnterAction="hero:+Magneted;this_anmSetHeroOnVert.Start();
                             @heroTunnelngX=0;@heroTunnelngY=@this_dirY"/>
            </IntersectionTrigger>
            
            <SequenceSet Id="this_anmSetHeroOnHor" RepeatCount="1" >
                <NumAnimation Target="hero.Y" From="hero.Y" To="this.Y+10" Duration="0.4" RepeatCount="1" Fill="End"/>
                <Do Action="hero:+Magneting;hero.SetDirection(-1*@this_dirX,-1*@this_dirY)" />
            </SequenceSet>

            <SequenceSet Id="this_anmSetHeroOnVert" RepeatCount="1" >
                <NumAnimation Target="hero.X" From="hero.X" To="this.X+6" Duration="0.4" RepeatCount="1" Fill="End"/>
                <Do Action="hero:+Magneting;hero.SetDirection(-1*@this_dirX,-1*@this_dirY)" />
            </SequenceSet>
            
        </Group>
    </Class>
</Include>
